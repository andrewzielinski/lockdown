<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link rel="stylesheet" href="stylesheets/screen.css" type="text/css" media="screen" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
      lockdown
  </title>
  <script src="javascripts/rounded_corners_lite.inc.js" type="text/javascript"></script>
<style>

</style>
  <script type="text/javascript">
    window.onload = function() {
      settings = {
          tl: { radius: 10 },
          tr: { radius: 10 },
          bl: { radius: 10 },
          br: { radius: 10 },
          antiAlias: true,
          autoPad: true,
          validTags: ["div"]
      }
      var versionBox = new curvyCorners(settings, document.getElementById("version"));
      versionBox.applyCornersToAll();
    }
  </script>
</head>
<body>
<div id="main">

    <h1>lockdown</h1>
    <div id="version" class="clickable" onclick='document.location = "http://rubyforge.org/projects/lockdown"; return false'>
      <p>Get Version</p>
      <a href="http://rubyforge.org/projects/lockdown" class="numbers">0.2.0</a>
    </div>
    <h1>&#x2192; &#8216;lockdown&#8217;</h1>


	<h3>Lockdown has not been officially released!  This page is a Work-In-Progress. The first version will be released by May 1st.</h3>


	<h2>What</h2>


	<p>Lockdown is a authentication/authorization system for RubyOnRails and Merb designed for simplicity and extensibility.  All access rules are in (initially) defined in lib/lockdown/access.rb.  With the included <span class="caps">ORM</span> support (ActiveRecord or DataMapper) and management screens you can add user defined rules to the system.</p>


	<p>If there is a &#8220;spec&#8221; directory, a test helper file will be included to provied some basic functionality for use with RSpec. This will show you how to create mock user objects and sign in as an adminstrator.</p>


	<p>Also included is functionality to auto-populate created_by and updated_by fields.</p>


	<p>Some model level access right functionality will also be added in the near future.</p>


	<h2>Installing</h2>


	<p>For the people who don&#8217;t care to know the details and just want to get the system installed:</p>


<pre>
$ sudo gem install lockdown
$ cd &lt;your_project_directory&gt;
$ lockdown .
</pre>

	<p>This will create a &#8220;lockdown&#8221; directory in the lib dir add two files: access.rb and session.rb.  Modify access.rb to define the rules that apply to your system.</p>


If you want the full &#8216;subsystem&#8217; (models, views, controllers, helpers):
<pre>
$ cd &lt;your_project_directory&gt;
$ ./script/generate lockdown_all
</pre>

	<p>I recommend reading this page to get a feel for Lockdown&#8217;s functionality.</p>


	<h2>How it works</h2>


Lockdown stores an array of access rights in the session.  For example, if you have a standard <span class="caps">REST</span> users controller, the access rights would be:
<pre>
  users/index
  users/show
  users/edit
  users/update
  users/new
  users/create
  users/destroy (delete for Merb)
</pre>

	<p>The above list will be stored in the session as an array and each request is tested against this list.  So this means, you <strong>should not use client side session storage</strong>.  If you can, I recommend using memcache, but a database session store will suffice.</p>


	<p>To define access rights you need to modify lib/lockdown/access.rb.  This is the default access.rb included with Lockdown:
<pre class='syntax'>
  <span class="ident">require</span> <span class="punct">&quot;</span><span class="string">lockdown</span><span class="punct">&quot;</span>

  <span class="keyword">module </span><span class="module">Lockdown</span>
  <span class="comment">#</span>
  <span class="comment">#</span>
  <span class="comment"># Permissions are used to group access rights into logical components.</span>
  <span class="comment"># Each method defined in the Permissions module represents an array</span>
  <span class="comment"># of methods from a controller (or multiple controllers.)</span>
  <span class="comment"># </span>
  <span class="comment"># Controller methods available are: </span>
  <span class="comment">#</span>
  <span class="comment">#   # Returns all methods from all controllers</span>
  <span class="comment">#   all_controllers</span>
  <span class="comment">#  </span>
  <span class="comment">#   # Returns all methods from all controllers listed</span>
  <span class="comment">#   all_methods :controller1, controller2, ...</span>
  <span class="comment">#  </span>
  <span class="comment">#   # For a single controller, returns only methods listed</span>
  <span class="comment">#   only_methods :controller1, :method1, :method2, ...</span>
  <span class="comment">#  </span>
  <span class="comment">#   # For a single controller, returns all methods except the methods listed</span>
  <span class="comment">#   all_except_methods :controller1, :method1, :method2, ...</span>
  <span class="comment">#</span>
  <span class="comment">#   They all return an array of controller/action.  For example, if you had a</span>
  <span class="comment">#   standard REST controller called products this would be the result:</span>
  <span class="comment">#</span>
  <span class="comment">#</span>
  <span class="comment">#     all_methods :products  =&gt; [ &quot;products/index , &quot;products/show&quot;,</span>
  <span class="comment">#                                 &quot;products/new&quot;, &quot;products/edit&quot;,</span>
  <span class="comment">#                                 &quot;products/create&quot;, &quot;products/update&quot;,</span>
  <span class="comment">#                                 &quot;products/destroy&quot;]</span>
  <span class="comment">#</span>
    <span class="keyword">module </span><span class="module">Permissions</span>
      <span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">self</span>
 
        <span class="keyword">def </span><span class="method">sessions_management</span>
          <span class="comment"># all_methods :sessions</span>
        <span class="keyword">end</span>

      <span class="keyword">end</span> <span class="comment"># end class block</span>
    <span class="keyword">end</span> <span class="comment"># end Permissions module</span>
 
  <span class="comment">#</span>
  <span class="comment"># UserGroups are used to group Permissions together to define role type</span>
  <span class="comment"># functionality. Users may belong to multiple groups.</span>
  <span class="comment"># </span>
    <span class="keyword">module </span><span class="module">UserGroups</span>
      <span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">self</span>

        <span class="comment">#</span>
        <span class="comment"># This method defines which UserGroups cannot be managed</span>
        <span class="comment"># via the management screens. </span>
        <span class="comment"># </span>
        <span class="comment"># Users can still be assigned to these groups.</span>
        <span class="comment">#</span>
        <span class="keyword">def </span><span class="method">private_records</span>
          <span class="punct">[</span><span class="symbol">:administrators</span><span class="punct">]</span>
        <span class="keyword">end</span>
        <span class="comment">#</span>
        <span class="comment"># This method defines which UserGroups have limited access</span>
        <span class="comment"># via the management screens. Deletion is not allowed.</span>
        <span class="comment"># </span>
        <span class="comment"># Users can still be assigned to these groups.</span>
        <span class="comment">#</span>
        <span class="keyword">def </span><span class="method">protected_records</span>
          <span class="punct">[</span><span class="symbol">:public_access</span><span class="punct">,</span> <span class="symbol">:registered_users</span><span class="punct">]</span>
        <span class="keyword">end</span>
         
        <span class="comment"># ** The administrator method is &quot;special&quot;, please don't rename.</span>
        <span class="comment">#			If you remove/rename, etc... YOU WILL BREAK STUFF</span>
        <span class="comment">#</span>
        <span class="comment"># Standard administrator user group.</span>
        <span class="comment"># Please don't alter without careful consideration.</span>
        <span class="comment">#</span>
        <span class="keyword">def </span><span class="method">administrators</span>
          <span class="punct">[</span><span class="symbol">:all</span><span class="punct">]</span>
        <span class="keyword">end</span>
         
        <span class="comment"># ** The public_access method is &quot;special&quot;, please don't rename.</span>
        <span class="comment">#			If you remove/rename, etc... YOU WILL BREAK STUFF</span>
        <span class="comment">#</span>
        <span class="comment"># Standard public_access user group.  </span>
        <span class="comment">#</span>
        <span class="comment"># Feel free to add Permissions to the array without issue.</span>
        <span class="comment">#</span>
        <span class="comment"># **Notice:  All permissions added to this public_access group will not be</span>
        <span class="comment">#             restricted to logged in users.</span>
        <span class="comment">#             So be careful what you add here!</span>
        <span class="comment">#</span>
        <span class="keyword">def </span><span class="method">public_access</span>
          <span class="punct">[</span><span class="symbol">:sessions_management</span><span class="punct">]</span> 
        <span class="keyword">end</span>
 
        <span class="comment"># ** The registered_users method is &quot;special&quot;, please don't rename.</span>
        <span class="comment">#			Not as special as the others, but still...</span>
        <span class="comment">#</span>
        <span class="comment"># All newly created users are assigned to this User Group by default</span>
        <span class="comment">#</span>
        <span class="comment">#  Sample registered_users permission:</span>
        <span class="comment"># [:my_account]</span>
        <span class="comment">#</span>
        <span class="keyword">def </span><span class="method">registered_users</span>
          <span class="punct">[]</span>
        <span class="keyword">end</span>

        <span class="comment">#</span>
        <span class="comment"># Define your own user groups below</span>
        <span class="comment">#</span>
      <span class="keyword">end</span> <span class="comment"># end class block</span>
    <span class="keyword">end</span> <span class="comment"># end UserGroups module</span>
  <span class="keyword">end</span> <span class="comment"># end Lockdown module</span>
</pre></p>


	<h2>Some History</h2>


	<p>Lockdown was initially designed as a authentication/authorization system to be configured by system administrators. This means it was database driven and had an interface to manage the access rights.  I didn&#8217;t like the static methodology of using code scattered amongst the controllers to define my access rights for the system.  I also didn&#8217;t like the fact that everything was accessible unless you restricted access.  So, I designed Lockdown to restrict access to all resources unless rights have been granted.</p>


	<p>The system was nice and worked well until I had a project that required RSpec tests.  I don&#8217;t have anything against testing frameworks (now that I&#8217;ve see the light) but what bothered me most what the fact that I would have to duplicate the information I already defined in my migrations as mock data.  I simply refused to do that extra work.  So, a serious refactoring of Lockdown was required.</p>


<blockquote>This is where the access.rb file was born. This file contains the rules that grant/deny access to your system.  More on this later.</blockquote>

	<p>After the RSpec project was completed, the refactoring continued.  This time the focus was on releasing the code to the masses.  I like this system a lot and think both the system itself and the community could benefit from releasing this as an open source project.</p>


	<p>In the middle of my refactoring for a public release, I made the decision to use Merb (when the choice was mine). This meant I needed to modify Lockdown for use with Merb.  So this is what I have done.</p>


	<p>There is code in place for using Lockdown with Rails, after all, that&#8217;s where Lockdown was born.  However, I have not yet tested the Rails functionality after this last refactor.  In addition, the deployment mechanism for Rails has to be tested.</p>


	<p>Writing code for public release is difficult and much different from architecting/coding for a closed source project.  A lot of things you could get by with in a proprietary application won&#8217;t be well received by the general public.  In addition, if you don&#8217;t make things easy, the adoption rate will probably be non-existent.</p>


	<h2>Forum</h2>


	<p>If you are having a problem understanding how to use Lockdown, please post your question on the lockdown group.  If it&#8217;s documentation related, I will keep this page updated to help everyone.</p>


	<p><a href="http://groups.google.com/group/stonean_lockdown?hl=en">http://groups.google.com/group/stonean_lockdown?hl=en</a></p>


	<h2>How to submit patches</h2>


	<p>The Clone <span class="caps">URL</span>: git://github.com/stonean/lockdown.git</p>


	<p>Read the <a href="http://drnicwilliams.com/2007/06/01/8-steps-for-fixing-other-peoples-code/">8 steps for fixing other people&#8217;s code</a> and for section <a href="http://drnicwilliams.com/2007/06/01/8-steps-for-fixing-other-peoples-code/#8b-google-groups">8b: Submit patch to Google Groups</a>, use the Google Group above.</p>


	<p>I&#8217;m new to git and this whole opensource project admin gig, so please be patient with my stumbling around.</p>


	<h2>License</h2>


	<p>This code is free to use under the terms of the <span class="caps">MIT</span> license.</p>


	<h2>Contact</h2>


	<p>Comments and suggestions are welcome via the <a href="http://groups.google.com/group/stonean_lockdown?hl=en">forum</a></p>
    <p class="coda">
      25th April 2008<br/>
      Theme extended from <a href="http://rb2js.rubyforge.org/">Paul Battley</a>
    </p>
</div>
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  var pageTracker = _gat._getTracker("UA-4189092-1");
  pageTracker._initData();
  pageTracker._trackPageview();
</script>
</body>
</html>
